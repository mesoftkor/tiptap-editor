{"version":3,"file":"TiptapEditor.js","sources":["../../src/react/TiptapEditor.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Editor } from '@tiptap/core';\r\nimport {\r\n  getDefaultExtensions,\r\n  addSlashCommandExtension,\r\n  getDefaultSlashItems,\r\n  uploadImageToS3,\r\n  fileToDataUrl,\r\n  type TiptapEditorBaseProps,\r\n  type UploadConfig,\r\n  type SlashCommandItem\r\n} from '../core';\r\nimport { SlashCommandMenu } from './SlashCommandMenu';\r\nimport './TiptapEditor.css';\r\n\r\nexport interface TiptapEditorProps extends TiptapEditorBaseProps {\r\n  uploadConfig?: UploadConfig;\r\n}\r\n\r\nexport const TiptapEditor: React.FC<TiptapEditorProps> = ({\r\n  content = '',\r\n  placeholder = '내용을 입력하세요...',\r\n  editable = true,\r\n  minHeight = '200px',\r\n  uploadCategory = 'notice',\r\n  initialImages = [],\r\n  onImageUpload,\r\n  onUnusedImagesChange,\r\n  onContentChange,\r\n  uploadConfig\r\n}) => {\r\n  const editorRef = useRef<HTMLDivElement>(null);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  const [editor, setEditor] = useState<Editor | null>(null);\r\n  const [uploadedImageUrls, setUploadedImageUrls] = useState<Set<string>>(new Set());\r\n  const [editorState, setEditorState] = useState({\r\n    canUndo: false,\r\n    canRedo: false,\r\n    isUpdated: 0\r\n  });\r\n\r\n  // Slash command menu state\r\n  const [showSlashMenu, setShowSlashMenu] = useState(false);\r\n  const [slashMenuItems, setSlashMenuItems] = useState<SlashCommandItem[]>([]);\r\n  const [slashMenuSelectedIndex, setSlashMenuSelectedIndex] = useState(0);\r\n  const [slashMenuPosition, setSlashMenuPosition] = useState({ top: 0, left: 0 });\r\n  const slashMenuPropsRef = useRef<any>(null);\r\n\r\n  const isInternalUpdateRef = useRef(false);\r\n\r\n  // Initialize editor\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    // Initialize uploaded images\r\n    const initialUrls = new Set<string>();\r\n    if (initialImages && initialImages.length > 0) {\r\n      initialImages.forEach((url) => {\r\n        if (url && !url.startsWith('data:') && !url.startsWith('blob:')) {\r\n          initialUrls.add(url);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Extract images from HTML if no initial images\r\n    if (initialUrls.size === 0 && content) {\r\n      const htmlImgRegex = /<img[^>]+src=\"([^\"]+)\"/g;\r\n      let m: RegExpExecArray | null;\r\n      while ((m = htmlImgRegex.exec(content)) !== null) {\r\n        const url = m[1];\r\n        if (url && !url.startsWith('data:') && !url.startsWith('blob:')) {\r\n          initialUrls.add(url);\r\n        }\r\n      }\r\n    }\r\n    setUploadedImageUrls(initialUrls);\r\n\r\n    // Get default extensions\r\n    let extensions = getDefaultExtensions({ editable, placeholder });\r\n\r\n    // Add slash command extension if editable\r\n    if (editable) {\r\n      extensions = addSlashCommandExtension(extensions, {\r\n        items: ({ query }: { query: string }) => getDefaultSlashItems({ query }),\r\n        render: () => ({\r\n          onStart: (props: any) => {\r\n            slashMenuPropsRef.current = props;\r\n            setSlashMenuItems(props.items);\r\n            setSlashMenuSelectedIndex(0);\r\n            setShowSlashMenu(true);\r\n\r\n            const { clientRect } = props;\r\n            if (clientRect) {\r\n              const rect = clientRect();\r\n              if (rect) {\r\n                setSlashMenuPosition({\r\n                  top: rect.bottom + window.scrollY + 8,\r\n                  left: rect.left + window.scrollX\r\n                });\r\n              }\r\n            }\r\n          },\r\n          onUpdate: (props: any) => {\r\n            slashMenuPropsRef.current = props;\r\n            setSlashMenuItems(props.items);\r\n            setSlashMenuSelectedIndex(0);\r\n\r\n            const { clientRect } = props;\r\n            if (clientRect) {\r\n              const rect = clientRect();\r\n              if (rect) {\r\n                setSlashMenuPosition({\r\n                  top: rect.bottom + window.scrollY + 8,\r\n                  left: rect.left + window.scrollX\r\n                });\r\n              }\r\n            }\r\n          },\r\n          onKeyDown: (props: any) => {\r\n            if (props.event.key === 'ArrowUp') {\r\n              setSlashMenuSelectedIndex((prev) => {\r\n                const items = slashMenuPropsRef.current?.items || [];\r\n                return (prev + items.length - 1) % items.length;\r\n              });\r\n              return true;\r\n            }\r\n            if (props.event.key === 'ArrowDown') {\r\n              setSlashMenuSelectedIndex((prev) => {\r\n                const items = slashMenuPropsRef.current?.items || [];\r\n                return (prev + 1) % items.length;\r\n              });\r\n              return true;\r\n            }\r\n            if (props.event.key === 'Enter') {\r\n              const items = slashMenuPropsRef.current?.items || [];\r\n              if (items[slashMenuSelectedIndex]) {\r\n                handleSelectSlashItem(slashMenuSelectedIndex);\r\n              }\r\n              return true;\r\n            }\r\n            if (props.event.key === 'Escape') {\r\n              setShowSlashMenu(false);\r\n              return true;\r\n            }\r\n            return false;\r\n          },\r\n          onExit: () => {\r\n            setShowSlashMenu(false);\r\n            slashMenuPropsRef.current = null;\r\n          }\r\n        })\r\n      });\r\n    }\r\n\r\n    const newEditor = new Editor({\r\n      element: editorRef.current,\r\n      extensions,\r\n      content: content || '',\r\n      editable,\r\n      onTransaction: ({ editor }) => {\r\n        setEditorState({\r\n          canUndo: editor.can().undo(),\r\n          canRedo: editor.can().redo(),\r\n          isUpdated: Date.now()\r\n        });\r\n      },\r\n      onUpdate: ({ editor }) => {\r\n        if (!isInternalUpdateRef.current && onContentChange) {\r\n          const newContent = editor.getHTML();\r\n          onContentChange(newContent);\r\n        }\r\n      },\r\n      editorProps: {\r\n        attributes: {\r\n          class: 'mesoft-tiptap-content'\r\n        },\r\n        handlePaste: (_view, event) => {\r\n          const items = event.clipboardData?.items;\r\n          if (!items) return false;\r\n          for (const item of Array.from(items)) {\r\n            if (item.type.startsWith('image/')) {\r\n              const file = item.getAsFile();\r\n              if (file) {\r\n                uploadAndInsertImage(file, newEditor);\r\n                return true;\r\n              }\r\n            }\r\n          }\r\n          return false;\r\n        },\r\n        handleDrop: (_view, event) => {\r\n          const dt = event.dataTransfer;\r\n          if (!dt || !dt.files?.length) return false;\r\n          for (const file of Array.from(dt.files)) {\r\n            if (file.type.startsWith('image/')) {\r\n              uploadAndInsertImage(file, newEditor);\r\n              return true;\r\n            }\r\n          }\r\n          return false;\r\n        }\r\n      }\r\n    });\r\n\r\n    setEditor(newEditor);\r\n\r\n    return () => {\r\n      newEditor.destroy();\r\n    };\r\n  }, []); // Only run once on mount\r\n\r\n  // Handle slash menu item selection\r\n  const handleSelectSlashItem = useCallback(\r\n    (index: number) => {\r\n      const item = slashMenuItems[index];\r\n      if (item && slashMenuPropsRef.current && editor) {\r\n        item.command({ editor, range: slashMenuPropsRef.current.range });\r\n        setShowSlashMenu(false);\r\n      }\r\n    },\r\n    [slashMenuItems, editor]\r\n  );\r\n\r\n  // Upload and insert image\r\n  const uploadAndInsertImage = async (file: File, editorInstance: Editor) => {\r\n    if (!editorInstance) return;\r\n\r\n    const blobUrl = URL.createObjectURL(file);\r\n    const { selection } = editorInstance.state;\r\n    const insertPos = selection.$anchor.pos;\r\n\r\n    editorInstance\r\n      .chain()\r\n      .insertContentAt(insertPos, {\r\n        type: 'image',\r\n        attrs: { src: blobUrl }\r\n      })\r\n      .run();\r\n\r\n    try {\r\n      let resultSrc: string;\r\n      let attrs: { src: string; alt?: string; title?: string };\r\n\r\n      if (onImageUpload) {\r\n        const res = await onImageUpload(file);\r\n        if (typeof res === 'string') {\r\n          resultSrc = res;\r\n          attrs = { src: resultSrc };\r\n        } else {\r\n          attrs = res;\r\n          resultSrc = res.src;\r\n        }\r\n      } else {\r\n        try {\r\n          resultSrc = await uploadImageToS3(file, uploadCategory, uploadConfig);\r\n          attrs = { src: resultSrc };\r\n        } catch (e) {\r\n          const errorMessage = e instanceof Error ? e.message : String(e);\r\n\r\n          if (errorMessage.includes('CORS')) {\r\n            console.warn('⚠️ S3 CORS 설정 필요:', errorMessage);\r\n            console.warn('→ Data URL로 폴백됩니다.');\r\n          } else {\r\n            console.error('S3 업로드 실패, Data URL로 폴백:', e);\r\n          }\r\n\r\n          resultSrc = await fileToDataUrl(file);\r\n          attrs = { src: resultSrc };\r\n        }\r\n      }\r\n\r\n      const { state } = editorInstance;\r\n      const imagePos = findImagePositionByUrl(state, blobUrl);\r\n\r\n      if (imagePos !== null) {\r\n        const tr = editorInstance.state.tr.setNodeMarkup(imagePos, undefined, attrs as any);\r\n        editorInstance.view.dispatch(tr);\r\n      }\r\n\r\n      if (!resultSrc.startsWith('data:') && !resultSrc.startsWith('blob:')) {\r\n        setUploadedImageUrls((prev) => new Set(prev).add(resultSrc));\r\n      }\r\n    } catch (err) {\r\n      console.error('이미지 업로드 실패:', err);\r\n      editorInstance.commands.undo();\r\n    } finally {\r\n      URL.revokeObjectURL(blobUrl);\r\n    }\r\n  };\r\n\r\n  const findImagePositionByUrl = (\r\n    state: import('@tiptap/pm/state').EditorState,\r\n    url: string\r\n  ): number | null => {\r\n    let pos: number | null = null;\r\n    state.doc.descendants((node, position) => {\r\n      if (node.type.name === 'image' && node.attrs.src === url) {\r\n        pos = position;\r\n      }\r\n    });\r\n    return pos;\r\n  };\r\n\r\n  const getCurrentImageUrls = useCallback((): Set<string> => {\r\n    const urls = new Set<string>();\r\n    if (!editor) return urls;\r\n\r\n    editor.state.doc.descendants((node) => {\r\n      if (node.type.name === 'image' && node.attrs.src) {\r\n        const src = node.attrs.src;\r\n        if (!src.startsWith('data:') && !src.startsWith('blob:')) {\r\n          urls.add(src);\r\n        }\r\n      }\r\n    });\r\n\r\n    return urls;\r\n  }, [editor]);\r\n\r\n  const calculateUnusedImages = useCallback(() => {\r\n    if (!onUnusedImagesChange) return;\r\n\r\n    const currentUrls = getCurrentImageUrls();\r\n    const unusedUrls: string[] = [];\r\n\r\n    uploadedImageUrls.forEach((url) => {\r\n      if (!currentUrls.has(url)) {\r\n        unusedUrls.push(url);\r\n      }\r\n    });\r\n\r\n    onUnusedImagesChange(unusedUrls);\r\n  }, [getCurrentImageUrls, uploadedImageUrls, onUnusedImagesChange]);\r\n\r\n  // Calculate unused images when editor state changes\r\n  useEffect(() => {\r\n    if (editor && uploadedImageUrls.size > 0) {\r\n      calculateUnusedImages();\r\n    }\r\n  }, [editorState.isUpdated, editor, uploadedImageUrls, calculateUnusedImages]);\r\n\r\n  // Toolbar actions\r\n  const toggleBold = () => editor?.chain().focus().toggleBold().run();\r\n  const toggleItalic = () => editor?.chain().focus().toggleItalic().run();\r\n  const toggleUnderline = () => editor?.chain().focus().toggleUnderline().run();\r\n  const toggleStrike = () => editor?.chain().focus().toggleStrike().run();\r\n  const toggleCode = () => editor?.chain().focus().toggleCode().run();\r\n  const setHeading = (level: 1 | 2 | 3) =>\r\n    editor?.chain().focus().toggleHeading({ level }).run();\r\n  const setParagraph = () => editor?.chain().focus().setParagraph().run();\r\n  const toggleBulletList = () => editor?.chain().focus().toggleBulletList().run();\r\n  const toggleOrderedList = () => editor?.chain().focus().toggleOrderedList().run();\r\n  const toggleCodeBlock = () => editor?.chain().focus().toggleCodeBlock().run();\r\n  const toggleBlockquote = () => editor?.chain().focus().toggleBlockquote().run();\r\n  const setTextAlign = (align: 'left' | 'center' | 'right' | 'justify') =>\r\n    editor?.chain().focus().setTextAlign(align).run();\r\n  const undo = () => editor?.chain().focus().undo().run();\r\n  const redo = () => editor?.chain().focus().redo().run();\r\n\r\n  const addLink = () => {\r\n    const url = window.prompt('URL을 입력하세요:');\r\n    if (url) {\r\n      let finalUrl = url;\r\n      if (!url.match(/^https?:\\/\\//)) {\r\n        finalUrl = `https://${url}`;\r\n      }\r\n      editor?.chain().focus().setLink({ href: finalUrl }).run();\r\n    }\r\n  };\r\n\r\n  const removeLink = () => editor?.chain().focus().unsetLink().run();\r\n\r\n  const addImageEnhanced = () => {\r\n    const url = window.prompt('이미지 URL을 입력하거나 취소하면 파일 업로드 창이 열립니다.');\r\n    if (url && url.trim()) {\r\n      const finalUrl = url.match(/^https?:\\/\\//) ? url : `https://${url}`;\r\n      editor?.chain().focus().setImage({ src: finalUrl }).run();\r\n      return;\r\n    }\r\n    fileInputRef.current?.click();\r\n  };\r\n\r\n  const handleFileSelected = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file || !editor) return;\r\n    await uploadAndInsertImage(file, editor);\r\n    e.target.value = '';\r\n  };\r\n\r\n  if (!editable) {\r\n    // Read-only view\r\n    return <div ref={editorRef} className=\"mesoft-tiptap-readonly\" />;\r\n  }\r\n\r\n  return (\r\n    <div className=\"mesoft-tiptap-wrapper\">\r\n      {/* Toolbar */}\r\n      <div className=\"mesoft-tiptap-toolbar\" onMouseDown={(e) => e.preventDefault()}>\r\n        {/* Text Style */}\r\n        <div className=\"toolbar-group\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={setParagraph}\r\n            className={`toolbar-btn ${editor?.isActive('paragraph') ? 'active' : ''}`}\r\n            title=\"본문\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M4 6h16M4 12h16M4 18h16\"\r\n              />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setHeading(1)}\r\n            className={`toolbar-btn ${editor?.isActive('heading', { level: 1 }) ? 'active' : ''}`}\r\n            title=\"제목 1\"\r\n          >\r\n            H1\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setHeading(2)}\r\n            className={`toolbar-btn ${editor?.isActive('heading', { level: 2 }) ? 'active' : ''}`}\r\n            title=\"제목 2\"\r\n          >\r\n            H2\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setHeading(3)}\r\n            className={`toolbar-btn ${editor?.isActive('heading', { level: 3 }) ? 'active' : ''}`}\r\n            title=\"제목 3\"\r\n          >\r\n            H3\r\n          </button>\r\n          <input\r\n            ref={fileInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            onChange={handleFileSelected}\r\n            style={{ display: 'none' }}\r\n          />\r\n        </div>\r\n\r\n        {/* Text Formatting */}\r\n        <div className=\"toolbar-group\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleBold}\r\n            className={`toolbar-btn ${editor?.isActive('bold') ? 'active' : ''}`}\r\n            title=\"굵게\"\r\n          >\r\n            <strong>B</strong>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleItalic}\r\n            className={`toolbar-btn ${editor?.isActive('italic') ? 'active' : ''}`}\r\n            title=\"기울임\"\r\n          >\r\n            <em>I</em>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleUnderline}\r\n            className={`toolbar-btn ${editor?.isActive('underline') ? 'active' : ''}`}\r\n            title=\"밑줄\"\r\n          >\r\n            <u>U</u>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleStrike}\r\n            className={`toolbar-btn ${editor?.isActive('strike') ? 'active' : ''}`}\r\n            title=\"취소선\"\r\n          >\r\n            <s>S</s>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleCode}\r\n            className={`toolbar-btn ${editor?.isActive('code') ? 'active' : ''}`}\r\n            title=\"코드\"\r\n          >\r\n            &lt;/&gt;\r\n          </button>\r\n        </div>\r\n\r\n        {/* Text Align */}\r\n        <div className=\"toolbar-group\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setTextAlign('left')}\r\n            className={`toolbar-btn ${editor?.isActive({ textAlign: 'left' }) ? 'active' : ''}`}\r\n            title=\"왼쪽 정렬\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M4 6h16M4 12h10M4 18h14\"\r\n              />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setTextAlign('center')}\r\n            className={`toolbar-btn ${editor?.isActive({ textAlign: 'center' }) ? 'active' : ''}`}\r\n            title=\"가운데 정렬\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M4 6h16M7 12h10M5 18h14\"\r\n              />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setTextAlign('right')}\r\n            className={`toolbar-btn ${editor?.isActive({ textAlign: 'right' }) ? 'active' : ''}`}\r\n            title=\"오른쪽 정렬\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M4 6h16M10 12h10M6 18h14\"\r\n              />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Lists */}\r\n        <div className=\"toolbar-group\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleBulletList}\r\n            className={`toolbar-btn ${editor?.isActive('bulletList') ? 'active' : ''}`}\r\n            title=\"글머리 기호\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M4 6h16M4 12h16M4 18h16\"\r\n              />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleOrderedList}\r\n            className={`toolbar-btn ${editor?.isActive('orderedList') ? 'active' : ''}`}\r\n            title=\"번호 매기기\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M9 5l7 7-7 7\"\r\n              />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Special Blocks */}\r\n        <div className=\"toolbar-group\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleBlockquote}\r\n            className={`toolbar-btn ${editor?.isActive('blockquote') ? 'active' : ''}`}\r\n            title=\"인용\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\"\r\n              />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={toggleCodeBlock}\r\n            className={`toolbar-btn ${editor?.isActive('codeBlock') ? 'active' : ''}`}\r\n            title=\"코드 블록\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4\"\r\n              />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Link & Image */}\r\n        <div className=\"toolbar-group\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={addLink}\r\n            className={`toolbar-btn ${editor?.isActive('link') ? 'active' : ''}`}\r\n            title=\"링크\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1\"\r\n              />\r\n            </svg>\r\n          </button>\r\n          {editor?.isActive('link') && (\r\n            <button\r\n              type=\"button\"\r\n              onClick={removeLink}\r\n              className=\"toolbar-btn remove-link\"\r\n              title=\"링크 제거\"\r\n            >\r\n              <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth=\"2\"\r\n                  d=\"M6 18L18 6M6 6l12 12\"\r\n                />\r\n              </svg>\r\n            </button>\r\n          )}\r\n          <button type=\"button\" onClick={addImageEnhanced} className=\"toolbar-btn\" title=\"이미지\">\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n              />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Undo/Redo */}\r\n        <div className=\"toolbar-group\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={undo}\r\n            className=\"toolbar-btn\"\r\n            disabled={!editorState.canUndo}\r\n            title=\"실행 취소\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6\"\r\n              />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={redo}\r\n            className=\"toolbar-btn\"\r\n            disabled={!editorState.canRedo}\r\n            title=\"다시 실행\"\r\n          >\r\n            <svg className=\"icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth=\"2\"\r\n                d=\"M21 10h-10a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6\"\r\n              />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Editor Content */}\r\n      <div className=\"mesoft-tiptap-content-wrapper\" style={{ minHeight }}>\r\n        <div ref={editorRef} className=\"mesoft-tiptap-editor\" />\r\n      </div>\r\n\r\n      {/* Slash Command Menu */}\r\n      {showSlashMenu && slashMenuItems.length > 0 && (\r\n        <div\r\n          className=\"mesoft-slash-menu-container\"\r\n          style={{\r\n            position: 'fixed',\r\n            top: slashMenuPosition.top,\r\n            left: slashMenuPosition.left,\r\n            zIndex: 50\r\n          }}\r\n        >\r\n          <SlashCommandMenu\r\n            items={slashMenuItems}\r\n            selectedIndex={slashMenuSelectedIndex}\r\n            onSelect={handleSelectSlashItem}\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n"],"names":["TiptapEditor","content","placeholder","editable","minHeight","uploadCategory","initialImages","onImageUpload","onUnusedImagesChange","onContentChange","uploadConfig","editorRef","useRef","fileInputRef","editor","setEditor","useState","uploadedImageUrls","setUploadedImageUrls","editorState","setEditorState","showSlashMenu","setShowSlashMenu","slashMenuItems","setSlashMenuItems","slashMenuSelectedIndex","setSlashMenuSelectedIndex","slashMenuPosition","setSlashMenuPosition","slashMenuPropsRef","isInternalUpdateRef","useEffect","initialUrls","url","htmlImgRegex","m","extensions","getDefaultExtensions","addSlashCommandExtension","query","getDefaultSlashItems","props","clientRect","rect","prev","items","_a","handleSelectSlashItem","newEditor","Editor","newContent","_view","event","item","file","uploadAndInsertImage","dt","useCallback","index","editorInstance","blobUrl","selection","insertPos","resultSrc","attrs","res","uploadImageToS3","e","errorMessage","fileToDataUrl","state","imagePos","findImagePositionByUrl","tr","err","pos","node","position","getCurrentImageUrls","urls","src","calculateUnusedImages","currentUrls","unusedUrls","toggleBold","toggleItalic","toggleUnderline","toggleStrike","toggleCode","setHeading","level","setParagraph","toggleBulletList","toggleOrderedList","toggleCodeBlock","toggleBlockquote","setTextAlign","align","undo","redo","addLink","finalUrl","removeLink","addImageEnhanced","handleFileSelected","jsxs","jsx","SlashCommandMenu"],"mappings":"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"}